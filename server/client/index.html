<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Golk</title>
    <link rel="shortcut icon" type="image/png" href="./favicon.png"/>
    <style>
      html {
        font-family: sans-serif;
        font-size: large;
        line-height: 1.4;
      }
      input[type=text] {
        padding: 4px;
        min-width: 20rem;
      }
      section {
        margin-bottom: 0.5rem;
      }
      label {
        display: inline-block;
        min-width: 10rem;
      }
    </style>
  </head>
  <body>
    <form method='GET'>
      <input type='hidden' id='apiKey' name='apiKey' />
      <input type='text' id='code' name='code' />
      <input type='submit' value='Go' />
    </form>
    <a href='./new_link.html'><button type='button' id='newLink'>New Link</button></a>
    <button type='button' id='reset'>Reset</button>
    <script>
      const storedEndpoint = localStorage.getItem('endpoint');
      const storedApiKey = localStorage.getItem('apiKey');

      if (storedEndpoint === null || storedApiKey === null) {
        // redirect
        window.location.replace('./setup.html');
      }

      const $form = document.querySelector('form');
      $form.setAttribute('action', storedEndpoint);

      const $apiKey = document.querySelector('input#apiKey');
      $apiKey.value = storedApiKey;

      document.querySelector('button#reset').addEventListener('click', e => {
        localStorage.removeItem('endpoint');
        localStorage.removeItem('apiKey');
        window.location.replace('./setup.html');
      });
    </script>
  </body>
</html>
